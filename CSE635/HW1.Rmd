---
title: "HW1_CSE635_MilesTaylor"
output: pdf_document
tables: true 
---

```{r setup, warning=FALSE, message=FALSE}
library(tidyverse)
library(kableExtra)
library(reticulate)
knitr::opts_chunk$set(echo = TRUE)
df = airquality
```

**Consider air quality data set with Ozone in parts per billion (ppb)as the dependent variable and Wind speed in miles per hour (mph) as the independent variable.**

Data was imported from the Air Quality data set available to all R users.

# Summary Statistics

```{r, summary of Air Quality Data}

kbl(summary(df)) %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```


**Show the scatter plot of Ozone ~ Wind**

# Intial Scatter Plot
```{r, scatterplot wind vs. ozone, warning=FALSE}

ggplot(data = df, aes(x = Wind, y = Ozone)) + 
  geom_point() + 
  ggtitle('Wind vs. Ozone') +
  xlab('Wind') +
  ylab('Ozone') + 
  theme_bw()


```

# Model Development

**Design an Eyeball model and compute the summary statistics of the resulting errors**


For the eyeball model test, develop a brute force line of best fit. For this homework,
I started with the assumption y=x and started to play around with the intercept and slope until I found a good candidate.


## Eyeball Model

```{python}

##Test some initial lines
import pandas as pd
import numpy as np
line_1 = pd.DataFrame(r.df.Wind * 4)
line_1['wind'] = r.df.Wind * -1/2 + 15
line_1.columns = ['line1', 'wind']

line_2 = pd.DataFrame(r.df.Wind)
line_2['wind'] = r.df.Wind * 1/2 + 16
line_2.columns = ['line2', 'wind']

line_3 = pd.DataFrame(r.df.Wind * 6 + 4)
line_3['wind'] = r.df.Wind
line_3.columns = ['line3', 'wind']


```

```{r, error= FALSE, message= FALSE, warning= FALSE}
ggplot(data = df, aes(x = Wind, y = Ozone)) +
  geom_point() + 
  geom_line(data = py$line_1, aes(x =wind, y = line1), color = 'red') +
  geom_line(data = py$line_2, aes(x =wind, y = line2), color = 'blue') +
  geom_line(data = py$line_3, aes(x =wind, y = line3), color = 'yellow') +
  ggtitle('Eyeball Model -- Wind vs. Ozone') +
  xlab('Wind') + 
  ylab('Ozone') + 
  theme_bw()
```

In the above graph, I plot the three lines generated from the eyeball model.
Line 1 is in red and corresponds to the formula y= Wind * -1/2 + 15.
Line 2 is in blue and corresponds to the formula y= Wind * 1/2 + 16.
Line 3 is in yellow and corresponds to the formula y= Wind * 6 + 4.

Line 1 is going to be the chosen line to compare against the LM model. The
error of the line displayed below.

```{python}
eyeball_error = pd.DataFrame(r.df.Ozone - line_1.line1.dropna())
eyeball_error.columns = ['eyeball_line']
eyeball_error['eyeball_line'] = np.where(eyeball_error.eyeball_line <-21474
, np.nan, eyeball_error.eyeball_line)
```


```{r, error = FALSE, message= FALSE, warning= FALSE}
ggplot() +
  geom_histogram(data=py$eyeball_error, 
                         aes(x = eyeball_line), 
                         binwidth = 2, 
                         colour = "black", 
                         fill = "yellow", 
                         alpha = 0.4)  +
  geom_density(data=py$eyeball_error, 
               aes(x = eyeball_line), 
               fill="azure3") +
  geom_vline(aes(xintercept = mean(py$eyeball_error[['eyeball_line']], 
                                   na.rm = T)),
            colour = "black", 
            linetype ="longdash", 
            size = .8) + ggtitle('Density Error Curve of Eyeball Model',
                                 ) + theme_bw()
```

Histogram of the errors is shown above for the eyeball model. The dotted black vertical
line shows the mean of the distribution of errors, which is not centered at 0 meaning
the estimation suffers from a slight negative skewness (bias).

The summary of the Eyeball model is shown below

```{r}

kbl(summary(py$eyeball_error))
```



**Execute R linear model function lm to design MMSE model and find the optimum intercept and optimum slope that predict Ozone level as a function of Wind speed**


## LM Model

```{r}

ols_model = lm(data = df, formula = Ozone ~ Wind)
ols_coef = ols_model$coefficients

```

```{python}

line_of_best_fit_lm = pd.DataFrame([r.ols_coef[1] * i + r.ols_coef[0] for i in r.df.Wind],
                                  columns = ['lobf_y'])
```


```{r, error= FALSE, message=FALSE, warning = FALSE}
ggplot(data = df, 
               aes(x = Wind, y = Ozone)) +
            geom_point() +
              geom_smooth(formula = y ~ x, method='lm') +
             ggtitle('OLS Model - Wind vs. Ozone') + 
            xlab('Wind') +
            ylab('Ozone') +
            theme_bw()
```


Ran OLS model in the above chart. The optimal slope and intercept are 
-5.5 and 96.8, respectively

```{r}
kbl(ols_coef) %>% kable_styling(bootstrap_options = c("striped", "hover"))
```

**Compute the summary statistics of the resulting errors of the MMSE model**


The summary of the LM model is shown below

```{r}

kbl(as.data.frame(coef(summary(ols_model))))
```

```{r}
errors = df$Ozone - py$line_of_best_fit_lm

kbl(summary(errors)) %>% kable_styling(bootstrap_options = c("striped", "hover"))
```


```{r, error=FALSE, message=FALSE, warning = FALSE}


ggplot() +
  geom_histogram(data=errors, 
                         aes(x = lobf_y), 
                         binwidth = 1, 
                         colour = "black", 
                         fill = "lightgreen", 
                         alpha = 0.4)  +
  geom_density(data=errors, 
               aes(x = lobf_y), 
               fill="azure3") +
  geom_vline(aes(xintercept = mean(errors[['lobf_y']], 
                                   na.rm = T)),
            colour = "black", 
            linetype ="longdash", 
            size = .8) + ggtitle('Density Error Curve of OLS Model',
                                 ) + theme_bw()
```


Histogram of the errors is shown above for the lm model. The dotted black vertical
line shows the mean of the distribution of errors, which is centered around 0 meaning
the OLS estimator is efficient and unbiased in estimation. Looking further into
the the summary provided by the summary() function, confirms this fact that P > t is
significant at the 1% level. Additionally, the confidence interval for the Wind 
variable (-6.9 to -4.1) doesn't cross 0. 


**Compare the errors of the two models: Eyeball, and MMSE**


# Conclusion


Winner: LM model

The lm model provides most efficient and unbiased estimation of the parameters from
this exercise. The residuals of the eyeball model have a mean of +2 and the std. deviation of the data set is 43, which means even if t or t+1 prediction is accurate, the precision of the
data set will be off by many factors.  In comparison, the lm model produces a mean of 0 
with a std. deviation of 26 meaning this predictor is more efficient and
less biased than the eyeball model for all quantiles of data. As stated above, the
lm model also produces a tight confidence interval that does not cross 0, so we can
be reasonably confident in our predictions at the 95% level. 
